<!-- F:\DOKUMEN\BACKUP\templates\index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Backup Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f4f4f4; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .btn { padding: 10px 20px; margin: 10px 5px; border: none; border-radius: 5px; cursor: pointer; }
    .primary { background: #007bff; color: white; }
    .secondary { background: #28a745; color: white; }
    pre { background: #eee; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1>☁️ Backup Dashboard</h1>
    <p>Status terakhir: <strong>{{ last_run }}</strong></p>

    <button onclick="runBackup()" class="btn primary">🚀 Jalankan Backup</button>
    <form id="upload-form" enctype="multipart/form-data" style="display:inline;">
      <label class="btn secondary">📤 Pilih File
        <input type="file" name="file" id="file-input" required style="display:none;">
      </label>
      <button type="submit" class="btn secondary">Upload</button>
    </form>

    <h3>📋 Log Aktivitas</h3>
    <pre>{{ log }}</pre>
  </div>

  <script>
    function runBackup() {
      fetch('/run-backup')
        .then(res => res.text())
        .then(html => {
          document.body.insertAdjacentHTML('beforeend', `<div style="display:none">${html}</div>`);
        })
        .catch(err => alert('❌ Error: Tidak bisa hubungi server'));
    }

    document.getElementById('upload-form').onsubmit = async (e) => {
      e.preventDefault();
      const file = document.getElementById('file-input').files[0];
      const formData = new FormData();
      formData.append('file', file);
      const res = await fetch('/upload', { method: 'POST', body: formData });
      if (res.ok) {
        alert(`✅ ${file.name} berhasil diupload!`);
        location.reload();
      } else {
        alert('❌ Gagal upload.');
      }
    };
  </script>
</body>
</html>